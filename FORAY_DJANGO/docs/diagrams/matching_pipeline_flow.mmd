flowchart TD
    %% Input Stage
    A[ğŸ“ CSV Files Input] --> B[ğŸ”„ Data Loading & Validation]
    B --> B1[ğŸ“Š Foray CSV<br/>983 Records]
    B --> B2[ğŸ—„ï¸ MycoBank CSV<br/>537k+ Records]
    
    %% Data Processing Stage
    B1 --> C[ğŸ§¹ Data Normalization]
    B2 --> C
    C --> C1[ğŸ“ Column Mapping]
    C --> C2[ğŸ”¤ String Cleaning]
    
    %% Index Building Stage
    C1 --> D[ğŸ” MycoBank Index Construction]
    C2 --> D
    D --> D1[ğŸ“š First-Letter Bucketing]
    D --> D2[ğŸ—ï¸ Candidate Structure]
    
    %% Processing Configuration
    D --> E[âš™ï¸ Processing Configuration]
    E --> E1[ğŸ§µ Worker Count Calculation]
    E --> E2[ğŸš© Feature Flags]
    
    %% Main Processing Loop
    E --> F[ğŸ”„ Main Processing Loop]
    D1 --> F
    D2 --> F
    
    %% Record Processing Decision Tree
    F --> G{ğŸ¯ Perfect Match?}
    
    %% Perfect Match Path
    G -->|YES| H[âœ… Perfect Match Processing]
    H --> H1[ğŸ’¾ Create ForayPerfectMatch]
    H1 --> H2{ğŸ¯ Exact DB Hit?}
    H2 -->|YES| H3[ğŸ† Create ForayPerfectMycoMatch]
    H2 -->|NO| H4[ğŸ“ Perfect Match Only]
    
    %% Mismatch Path
    G -->|NO| I[âš ï¸ Mismatch Processing]
    I --> I1[ğŸ“‹ Mismatch Classification]
    I1 --> I2{ğŸ” Which Names Match?}
    I2 -->|Org+Conf| I3[ğŸ“Š ORG_CONF_MATCH]
    I2 -->|Org+Foray| I4[ğŸ“Š ORG_FORAY_MATCH]  
    I2 -->|Conf+Foray| I5[ğŸ“Š CONF_FORAY_MATCH]
    I2 -->|None| I6[ğŸ“Š ALL_DIFFERENT]
    
    I3 --> J[ğŸ’¾ Create ForayMismatchExplanation]
    I4 --> J
    I5 --> J
    I6 --> J
    
    %% Parallel Candidate Search
    J --> K[ğŸ”„ Parallel Candidate Search]
    K --> K1[ğŸ§µ Thread 1: ORG]
    K --> K2[ğŸ§µ Thread 2: CONF]
    K --> K3[ğŸ§µ Thread 3: FORAY]
    
    %% Best Match Algorithm
    K1 --> L[ğŸ¯ Best Match Algorithm]
    K2 --> L
    K3 --> L
    L --> L1[ğŸ”¤ First Letter Lookup]
    L1 --> L2[ğŸ“Š RapidFuzz Scoring]
    L2 --> L3[ğŸ† Choose Higher Score]
    L3 --> L4[ğŸ’° LRU Cache Storage]
    
    %% Result Selection
    L --> M[ğŸ“Š Score Comparison & Selection]
    M --> M1[ğŸ¥‡ Choose Best Overall]
    M1 --> M2[ğŸ’¾ Create ForayMismatchMycoScores]
    
    %% Output Stage
    H3 --> N[ğŸ“¤ Results Output]
    H4 --> N
    M2 --> N
    
    N --> N1[ğŸ“Š ForayPerfectMatch]
    N --> N2[ğŸ“‹ ForayMismatchExplanation]
    N --> N3[ğŸ† ForayPerfectMycoMatch]
    N --> N4[ğŸ“ˆ ForayMismatchMycoScores]
    
    %% Progress Reporting
    F --> P[ğŸ“Š Progress Reporting]
    P --> P1[â±ï¸ Every 100 Records]
    P --> P2[ğŸ“ˆ Result Counts]