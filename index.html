<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fungal Match Viewer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/css/bootstrap-select.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
    <h1 class="mb-4">ðŸ§¬ Foray â†” MycoBank Matching Results</h1>

    <form method="POST" class="row g-3 mb-4">
        <!-- Search -->
        <div class="col-md-3">
            <input name="search" type="text" class="form-control" placeholder="Search Foray Name" value="{{ search }}">
        </div>

        <!-- Status -->
        <div class="col-md-2">
            <select name="status_filter" class="form-select">
                <option {% if request.form.get('status_filter') == 'All' %}selected{% endif %}>All</option>
                <option value="SAME" {% if request.form.get('status_filter') == 'SAME' %}selected{% endif %}>SAME</option>
                <option value="UPDATED" {% if request.form.get('status_filter') == 'UPDATED' %}selected{% endif %}>UPDATED</option>
                <option value="NO_MATCH" {% if request.form.get('status_filter') == 'NO_MATCH' %}selected{% endif %}>NO MATCH</option>
            </select>
        </div>

        <!-- Similarity Multi-Select -->
        <div class="col-md-3">
            <select name="sim_filter" class="form-select selectpicker" multiple data-live-search="true" data-actions-box="true" data-width="100%" title="Filter by Similarity">
                <option value="100">100</option>
                <option value="90-100">90â€“100</option>
                <option value="80-90">80â€“90</option>
                <option value="70-80">70â€“80</option>
                <option value="50-70">50â€“70</option>
                <option value="<50">&lt;50</option>
                <option value="NO MATCH">NO MATCH</option>
            </select>
        </div>

        <!-- Explanation -->
        <div class="col-md-3">
            <select name="explanation_filter" class="form-select">
                <option value="All" {% if request.form.get('explanation_filter') == 'All' %}selected{% endif %}>All</option>
                <option value="FORAY â†’ TAXON" {% if request.form.get('explanation_filter') == 'FORAY â†’ TAXON' %}selected{% endif %}>Foray â†’ Taxon</option>
                <option value="FORAY â†’ UPDATED" {% if request.form.get('explanation_filter') == 'FORAY â†’ UPDATED' %}selected{% endif %}>Foray â†’ Updated</option>
                <option value="ORG â†’ TAXON" {% if request.form.get('explanation_filter') == 'ORG â†’ TAXON' %}selected{% endif %}>Org â†’ Taxon</option>
                <option value="ORG â†’ UPDATED" {% if request.form.get('explanation_filter') == 'ORG â†’ UPDATED' %}selected{% endif %}>Org â†’ Updated</option>
            </select>
        </div>

        <!-- Question Mark -->
        <div class="col-md-2">
            <select name="question_mark_filter" class="form-select">
                <option value="All" {% if request.form.get('question_mark_filter') == 'All' %}selected{% endif %}>All</option>
                <option value="Contains" {% if request.form.get('question_mark_filter') == 'Contains' %}selected{% endif %}>Name contains ?</option>
                <option value="Not Contains" {% if request.form.get('question_mark_filter') == 'Not Contains' %}selected{% endif %}>Name does not contain ?</option>
            </select>
        </div>

        <!-- Submit -->
        <div class="col-md-2 d-grid">
            <button type="submit" class="btn btn-primary">Filter</button>
        </div>
    </form>

    <div class="mb-3">
        <a href="/download" class="btn btn-success btn-sm">ðŸ“¥ Download filtered results</a>
        <span class="float-end">Showing <strong>{{ total }}</strong> results</span>
    </div>

    <table class="table table-bordered table-hover align-middle small">
        <thead class="table-dark">
            <tr>
                <th>Foray ID</th>
                <th>Foray Name</th>
                <th>Org Entry</th>
                <th>Taxon Name</th>
                <th>Updated Name</th>
                <th>Similarity</th>
                <th>Status</th>
                <th>Explanation</th>
                <th>Detail</th>
            </tr>
        </thead>
        <tbody>
            {% for row in tables %}
            <tr>
                <td>{{ row['Foray_ID'] }}</td>
                <td>{{ row['Foray_Name'] }}</td>
                <td>{{ row['Org_Entry'] }}</td>
                <td>{{ row['Taxon_Name'] }}</td>
                <td>{{ row['Updated_Taxon_Name'] }}</td>
                <td>{{ row['Similarity'] }}</td>
                <td>{{ row['Status'] }}</td>
                <td>{{ row['Explanation'] }}</td>
                <td><a class="btn btn-sm btn-outline-info" href="/detail/{{ row['Foray_ID'] }}">View</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Bootstrap JS + Select plugin -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta3/dist/js/bootstrap-select.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        $('.selectpicker').selectpicker('render');
    });
</script>
</body>
</html>
